<!doctype html>
<html>
<title>KiPro Sequences</title>
<head>
<meta charset="utf-8">
<script src="./ext.js"></script>
<script src="./lib/CSInterface.js"></script>
<script src="./lib/jquery-1.9.1.js"></script>
<script src="./lib/Vulcan.js"></script>
<script src="./jsx/createSequencesFromBin.jsx"></script>
<script src="./jsx/exportSequencesToME.jsx"></script>
<link id="ppstyle" href="css/style.css" rel="stylesheet" type="text/css">
<script type="text/javascript">
	document.addEventListener('DOMContentLoaded', function() {
        var csInterface = new CSInterface();

        // Get the extension root path and immediately normalize it to use forward slashes.
        // This works reliably on both Windows and macOS.
        var extensionRoot = csInterface.getSystemPath(SystemPath.EXTENSION);
        var normalizedExtensionRoot = extensionRoot.replace(/\\/g, '/');


        // listener for createSequencesFromBin button
        document.getElementById('createSequencesFromBin').onclick = function() {
            var binName = document.getElementById('binNameInput').value;
            if (binName) {
                // Escape quotes in user input and pass the normalized extension path
                var safeBinName = binName.replace(/"/g, '\\"');
                csInterface.evalScript('$._PPP_.createSequencesFromBin("' + safeBinName + '", "' + normalizedExtensionRoot + '")');
            }
        };

        // listener for exportSequencesToME button
        document.getElementById('exportSequencesToME').onclick = function() {
            var binName = document.getElementById('binNameInput').value;
            var exportBasePath = document.getElementById('exportBasePathInput').value;

            if (binName && exportBasePath) {
                // Normalize the user-provided path as well
                var normalizedExportPath = exportBasePath.replace(/\\/g, '/');

                // Construct the payloads path. Appending a slash is now simple and clean.
                var payloadsPath = normalizedExtensionRoot + '/payloads/';

                // Escape any quotes in the inputs before passing them to ExtendScript
                var safeBinName = binName.replace(/"/g, '\\"');
                var safeExportPath = normalizedExportPath.replace(/"/g, '\\"');
                
                csInterface.evalScript('$._PPP_.exportSequencesToME("' + safeBinName + '", "' + safeExportPath + '", "' + payloadsPath + '")');
            }
        };
    });
</script>
</head>

<!-- The body of the HTML document -->
<body>
	<p>Name of bin to create sequences</p>
	<input type="text" id="binNameInput" placeholder="Enter bin name" value="animation" />
	<br/>
	<p>Name of black frame at beginning</p>
	<input type="text" id="blackFrameInput" placeholder="Enter black_frame name" value="schwarz_frame" />
	<br/>
	<p>Export base path</p>
	<input type="text" id="exportBasePathInput" placeholder="I:\2025\2025-festival\converting_dnx\out" value="I:\2025\2025-festival\converting_dnx\out" />
	<br/>
		<button id="createSequencesFromBin">Create Sequences</button>
		<button id="exportSequencesToME">Export Sequences to ME</button>
</body>
</html>
